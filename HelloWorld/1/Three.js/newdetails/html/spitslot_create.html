<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>我要吐槽</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		
		<link href="../css/mui.min.css" rel="stylesheet"/>
		<link href="../css/common.css" rel="stylesheet" />

	   
	</head>
	<body>
	<header class="mui-bar mui-bar-nav mui-search-box">
		<a href="javascript:void(0);" class="mui-back mui-action-back"></a>
		<h4 class="mui-title">我要吐槽</h4>
		<a class="mui-link" id="tucaoRecords">吐槽记录</a>
	</header>
	
	<div class="mui-iframe-wrapper" style="top: 44px;">
		<div class="mui-row mui-complain mui-spitslot-content">
			<div class="mui-col-xs-12 ">
				<p class="mui-detail-title"><b>选择吐槽的类型</b></p>
				<div class="mui-clearfix mui-com-tickets" id="spitslotType">
					<div class="mui-col-xs-3 mui-pull-left mui-com-ticket active"><b>沙井生蚝</b></div>
					<div class="mui-col-xs-3 mui-pull-left mui-com-ticket"><b>风土人情</b></div>
					<div class="mui-col-xs-3 mui-pull-left mui-com-ticket"><b>特色美食</b></div>
					<div class="mui-col-xs-3 mui-pull-left mui-com-ticket"><b>环境差</b></div>
					<div class="mui-col-xs-3 mui-pull-left mui-com-ticket"><b>其它</b></div>
				</div>
				
				<div class="mui-col-xs-12 mui-spitslot-textarea">
					<textarea class="mui-textarea" rows="4" placeholder="填写您要吐槽的内容" id="publish_content"></textarea>
					<a class="mui-spitslot-vedio" href="javascript:void(0);">照片/视频<input type="file" class="upload_img" /></a>
				</div>
			</div>
			
		</div>
		<div class="mui-col-xs-12 mui-text-center mui-spitslot-btns">
			<!--不可点击-->
			<a href="javascript:void(0);" class="mui-btn mui-spitslot-btn" style="display: none;">提交</a>
			<!--可点击-->
			<a href="javascript:void(0);" class="mui-btn mui-spitslot-btn mui-active" id="submitBtn">提交</a>
		</div>
	</div>
	<script src="../js/mui.min.js"></script>
	<script src="../../mobile/layer.js"></script>
	<script src="../../js/path.js"></script>
	<script src="../../js/jquery-1.9.1.js"></script>
	<script type="text/javascript" charset="utf-8">
		  	mui.init();
		  	mui.ready(function(){
		  		//吐槽记录
		  		var tucaoRecords = document.getElementById("tucaoRecords");
		  		tucaoRecords.addEventListener('tap',function(e){
		  			mui.openWindow('spitslot_list.html');
		  		});
		  	});
		  	
		  	var currentInfo = localStorage.getItem("currentInfo");
			if(currentInfo){
				currentInfo = JSON.parse(currentInfo);
		  	var spitslotType = document.getElementById("spitslotType");
		  	var typeList = [];//保存吐槽数据类型
		  	var currentIndex = 0;
		  	//查询吐槽类型数据
		  	(function(){
		  		
		  		mui.ajax(JS_PATH+'/spitslot/queryType',{
							data:{
								
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'post',//HTTP请求类型
							success:function(data){
								typeList = data||[];
								//获得服务器响应
								spitslotType.innerHTML = "";
								for(var i=0,m=data.length;i<m;i++){
									var item = data[i];
									spitslotType.innerHTML+='<div class="spitslotType mui-col-xs-3 mui-pull-left mui-com-ticket '+(i==3?"active":"")+'"><b>'+item.name+'</b></div>';
									
								}
								var spitsList = document.querySelectorAll('.spitslotType');
								for(var i=0,m=spitsList.length;i<m;i++){
									var spit = spitsList[i];
									spit.addEventListener('tap',function(){
										
										$(this).addClass('active');
										$(this).siblings().removeClass('active');
										console.log($(this).index());
										currentIndex = $(this).index();
									})
								}
								
							},error:function(e){
								mui.toast("系统出错");
							}
						});
		  		
		  		var publish_content = document.getElementById('publish_content');//要提交的内容
		  		var submitBtn = document.getElementById("submitBtn");
		  		submitBtn.addEventListener('tap',function(){
		  			humanAjax(JS_PATH+'/spitslot/add',{
							data:{
								publish_content:publish_content.value,
								publish_time:(new Date()).Format('yyyy-MM-dd HH:mm:ss'),
								scenice_id:currentInfo.id,
								scenice_name:currentInfo.title,
								type_id:typeList[currentIndex].id
								
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'post',//HTTP请求类型
							success:function(data){
								if(data.code == 200){
									mui.toast("提交成功");
								}else{
									mui.toast("提交失败");
								}
								
							},error:function(e){
								mui.toast("系统出错");
							}
						});
		  		});
		  		
		  	})();
		  	}
		  	
	</script>
	</body>
</html>
