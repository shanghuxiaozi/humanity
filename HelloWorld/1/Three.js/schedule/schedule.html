<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta
	content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"
	name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta content="telephone=no" name="format-detection" />
<meta content="email=no" name="format-detection" />
<meta charset="UTF-8" />
		<title>WINDOW_RESIZE</title>
		<link rel="stylesheet" href="../css/schedule.css">
		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/mui/mui.min.css">
		<link rel="stylesheet" href="../mobile/need/layer.css">
		
	</head>
	<body style="margin: 0;padding: 0;overflow-x:hidden;overflow-y:hidden;">
		<!--<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">底部选项卡-div模式</h1>
		</header>-->
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" href="javascript:void(0)" dataindex="false">
				<span class="mui-icon mui-icon-home">
					<!--<img src="../icon/tab_homeh_icon.png"/>-->
				</span>
				<span class="mui-tab-label">首页</span>
			</a>
			<!--../hello-mui/index.html  ../scan/imageRecognition.html-->
			<a class="mui-tab-item" href="../detail/scan.html" name="scan">
				<span class="mui-icon  mui-icon-phone">
					<!--<img src="../icon/tab_saoyisao_icon.png"/>-->
				</span>
				<span class="mui-tab-label">扫一扫</span>
			</a>
			<a class="mui-tab-item" href="../newdetails/html/share_companion.html" >
				<span class="mui-icon  mui-icon-email">
					<!--<img src="../icon/tab_fenxiang_icon.png"/>-->
					<span class="mui-badge">9
					</span>
				</span>
				<span class="mui-tab-label">分享</span>
			</a>
			<!--<a class="mui-tab-item" href="https://layaair.ldc.layabox.com/demo/h5/demo.html?3d&scene&SceneLoad&core,webgl,ani,d3,CameraMoveScript.js">-->
			<!--<a class="mui-tab-item" href="https://layaair.ldc.layabox.com/demo/h5/demo.html?2d&Interaction&Rotate&core,webgl">-->
			<!--<a class="mui-tab-item" href="https://layaair.ldc.layabox.com/demo/h5/demo.html?2d&Physics&Slingshot&core,webgl,matter.js,LayaRender.js">-->
			<!--<a class="mui-tab-item" href="https://layaair.ldc.layabox.com/demo/h5/demo.html?2d&Particle&T2&core,webgl,particle">-->
			<!--<a class="mui-tab-item" href="http://120.25.221.94/vrdemoOne.html">-->
			<!--<a class="mui-tab-item" href="http://120.25.221.94/refraction.html">-->
			<!--<a class="mui-tab-item" href="http://120.25.221.94/threejs/three.js-master/examples/refraction.html">-->
			<!--<a class="mui-tab-item" href="https://layaair.ldc.layabox.com/demo/h5/demo.html?3d&particle&Particle_Scene&core,webgl,ani,d3,CameraMoveScript.js">-->
			<!--<a class="mui-tab-item" href="https://layaair.ldc.layabox.com/demo/h5/demo.html?3d&particle&Particle_BurningGround&core,webgl,ani,d3">-->
			<!--<a class="mui-tab-item" href="https://layaair.ldc.layabox.com/test/ZhanPaiKeJi/index.html">-->
			<!--<a class="mui-tab-item" href="https://ritterliu.github.io/WebVR_Demo/">-->
				<a class="mui-tab-item" href="../newdetails/html/user.html"/>
				<span class="mui-icon mui-icon-gear">
					<!--<img src="../icon/tab_me_icon.png"/>-->
				</span>
				<span class="mui-tab-label">我</span>
			</a>
		</nav>
		<div class="mui-content">
		<div id="allmap" ></div>
		<div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;z-index:99999999;position: absolute;left: 10px;top: 20px;"></div>
		</div>
			<!--<div id="legend"></div>-->
		<iframe scrolling="no" src="../schedule/lufy.html" id="lufy"></iframe>
			<div id="r-result">
				<!--<div class="mui-input-row mui-search">-->
					<!--../static/destination.html-->
					<a href="../detail/indexed-list.html"  id="currentCityContent">
						<input value="深圳" />
						<span class="mui-icon mui-icon-arrowdown" id="arrowdown"></span>
						<!--<div id="selectArea"></div>-->
					</a>
					
					<p >
                  
                    
				    <input type="search" class="mui-input-clear "  id="suggestId" placeholder="搜索人文景点" >
					<img src="../images/schedule/ser.png" />
					</p>
                    
				    
				<!--</div>-->
			</div>
			<div id="info">
				<ul class="mui-table-view">
			    <li class="mui-table-view-cell mui-media">
			        <a href="javascript:void(0);" id="infoA" dataindex="infoA">
			            <img class="mui-media-object mui-pull-left"  onerror="this.src='../images/nebula-xneg.png'" id="imgInfo">
			            <div class="mui-media-body" id="infoContent">
			                深圳
			                <p class='mui-ellipsis-2'>来了就是惠州人!</p>
			            </div>
			        </a>
			    </li>
			    </ul>
				 <div class="mui-button-row">
				<button id="vrBtn" type="button" class="mui-btn"></button>
				<button id="videoBtn" type="button" class="mui-btn"></button>
				</div>
			</div>
			<div id="spot"></div>
			<div id="backmap"><span class="mui-icon mui-icon-undo"></span>返回</div>
			
			
			<!--
            	作者：921233883@qq.com
            	时间：2017-10-28
            	描述：活动页面下拉菜单
            -->
			<div id="activity_menu"><a id="icon-menu" class="mui-action-menu mui-icon mui-icon-bars mui-pull-left"  dataindex="false"></a></div>
			<div id="menu-wrapper" class="menu-wrapper hidden">
			<div id="menu" class="menu bounce-in-down animated">
				<ul class="mui-table-view mui-table-view-inverted" id="activity_content">
					<!--<li class="mui-table-view-cell">
						<a href="javascript:;" dataindex="false">Item 1</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="javascript:;" dataindex="false">Item 2</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="javascript:;" dataindex="false">Item 3</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="javascript:;" dataindex="false">Item 4</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="javascript:;" class="" dataindex="false">Item 5</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="javascript:;" dataindex="false">Item 6</a>
					</li>
					<li class="mui-table-view-cell">
						<a href="javascript:;" class="" dataindex="false">Item 7</a>
					</li>-->
				</ul>
			</div>
		</div>
		<div id="menu-backdrop" class="menu-backdrop" style="opacity: 1;"></div>
			
			
			<!--<div id="overview"><img src="../images/schedule/dinwei.png" /> <p>赛程总览</p> </div>
			<div id="notice"><img src="../images/schedule/remind.png"/>参与游戏赢取丰富礼品!</div>-->
			<div id="introduction"></div>
			<!--
            	作者：921233883@qq.com nohup node mycraft.js > sw.log 2>&1 &

            	时间：2017-08-01
            	描述：叫车
            -->
			<!--<div id="takeAtaxi"><img src="../images/schedule/car.png"/></div>-->
			
		<script src="../mobile/layer.js"></script>
		<script>
			var layerIndex = layer.open({
						    type: 2
						    ,content: '搜索中'
						  });
		</script>
		<!-------------------------------------------------------------百度地图相关js-------------------------------------------------------------->	
		<script src="../js/map/baidu.js" charset="utf-8" type="text/javascript"></script>
		<!--<script type="text/javascript" src="http://api.map.baidu.com/library/LuShu/1.2/src/LuShu_min.js"></script>-->

		<script src="../js/mui/mui.js"></script>
		<!--加载鼠标绘制工具-->
		<script src="../js/map/DrawingManager_min.js" charset="utf-8" type="text/javascript"></script>
		<!--加载检索信息窗口-->
		<script src="../js/map/SearchInfoWindow_min.js" charset="utf-8" type="text/javascript"></script>
		
		<script src="../js/map/bookingMap.js" charset="utf-8" type="text/javascript"></script>
		<script src="../js/tween/TweenLite.js"></script>
		<script src="../js/path.js"></script>
		<script type="text/javascript" src="http://api.map.baidu.com/library/CurveLine/1.5/src/CurveLine.min.js"></script>
		<!--<script src="../hello-mui/js/jquery-2.1.0.js"></script>-->
		<!--<script src="../js/mui/mui.jsonp.js"></script>-->
			<script>
				var sprite = null;//点击图标显示button集合的精灵容器
				var lengend = document.getElementById("legend");//canvas容器
				var allmap = document.getElementById("allmap");
				allmap.style.height = window.innerHeight+"px";
				allmap.style.backgroundPositionX = window.innerWidth/2-21+"px";
				allmap.style.backgroundPositionY = window.innerHeight/2-21+"px";
				var info = document.getElementById("info");
				var infoContent = document.getElementById("infoContent");
				var imgInfo = document.getElementById("imgInfo");
				
				var resultPanel = document.getElementById('r-result');//搜索框
				
				//
				var map;
				var currentInfo;//当前点击的景点
				var lufyTime = setTimeout(function(){
					getLufy();
					
				},1000);
				var lufy = document.getElementById('lufy');
				
				lufy.addEventListener('tap',function(){
					alert(88)
				})
				
				function getLufy(){
					clearTimeout(lufyTime);
					
					if((lufy.contentWindow).initData){
						(lufy.contentWindow).initData(allmap,lufy,info,function(s,l){
							//sprite = s;
							lengend = l;
						},function(){
							localStorage.setItem("currentInfo",JSON.stringify(currentInfo));
				    		window.location.href = "../newdetails/html/tourist.html";
						});
					}else{
						lufyTime = setTimeout(function(){
							getLufy();
						},1000);
					}
				}
				
			initMap();
			function initMap(){
//				mui.init({
//					swipeBack:true ,//启用右滑关闭功能
//					 preloadPages:[
//				    {
//				      url:"../circle/index.html",//"http://120.25.221.94/human/1/Three.js/circle/index.html",
//				      id:"circle",
//				      styles:{},//窗口参数
//				      extras:{},//自定义扩展参数
//				      subpages:[{},{}]//预加载页面的子页面
//				    }
//				  ],
//				   preloadLimit:5//预加载窗口数量限制(一旦超出,先进先出)默认不限制
//				});
				mui.init();
				var circle;
				
//				document.addEventListener( "plusready", onPlusReady, false );
				// 扩展API加载完毕，现在可以正常调用扩展API
				function onPlusReady() {
					circle = plus.webview.getWebviewById('circle'); 
					/*setTimeout(function(){
						var array = plus.webview.all();
						if(array){
							for(var i=0,len=array.length;i<len;i++){
							    	alert(array[i].getURL());
						        }
						}
					},10000)*/
//					for(var i=0;i<plus.webview.all().length;i++){
//						alert(plus.webview.all()[i].id);
//					}
					//(plus.webview.getWebviewById("H58A84A3C")).back()
//					alert('=='+plus.webview.currentWebview().parent().id);
					
				};
				var currentCity = '郑州'//localStorage.getItem("currentCity");
				var chooseCity;
				var currentCenter;//当前地图的中心点，做活动返回时用
				function queryCityPosNow(){
    				chooseCity = localStorage.getItem("chooseCity");
        			if(chooseCity && chooseCity.length>2 && chooseCity.indexOf('市')!=-1){
						chooseCity = chooseCity.replace('市','');
					}
        			currentCityContent.innerHTML = '<input readonly value="'+(chooseCity||'深圳')+'" /><span class="mui-icon mui-icon-arrowdown" id="arrowdown"></span>';
        			queryCityId((chooseCity||'深圳'));
    			}
				var isPageShow= false;  
			    window.addEventListener('pageshow', function () {  
			        isPageShow= false; 
			        if(	localStorage.getItem('city_nme')!='over'){
			        		if(localStorage.getItem('city_nme')!='lat'){
			        			map.centerAndZoomByName(localStorage.getItem('city_nme'));
			        			isPageShow = true;
			        			queryCityPosNow();
			        			
			        		}else{
			        			isPageShow = true;
			        			map.centerAndZoomByName(new BMap.Point(parseFloat(localStorage.getItem('city_lng')),parseFloat(localStorage.getItem('city_lat'))));
			        			queryCityPosNow();
			        		}
			        		
			        		localStorage.setItem('city_nme','over');
			        }
			        
			        
			        
			    });  
			    window.addEventListener('pagehide', function () {  
			        isPageShow = false;  
			    });  
				
				
				var spot = document.getElementById("spot");
				var activity_menu = document.getElementById("activity_menu");//活动页面下来菜单
				var activity_content = document.getElementById("activity_content");//活动页面内容
				var backmap = document.getElementById("backmap");//活动也返回按钮
				backmap.addEventListener('tap',function(e){
					console.log('从活动页面返回');
					e.stopPropagation();
					setTimeout(function(){
						resultPanel.style.display = "block";//由于此按钮与返回按钮处于同一层，当返回后会被触发因此需要延迟显示
						resultPanel.style.pointerEvents = "auto";
					},1500);
					
					document.querySelector('.BMap_geolocationContainer').style.display = "block";
					
					
					backmap.style.display = "none";
					activity_menu.style.display = "none";
					spot.style.top = "68px";
					map.isActivity = false;
					hideActivityPanel();
        			map.centerAndZoomByName(currentCenter);
        			queryCityPosNow();
			        		
				})
				
				var suggestId = document.getElementById("suggestId");
				suggestId.addEventListener('tap',function(){
					console.log("被点");
					suggestId.focus();
				})
				
				
				
				mui('body').on('tap','a',function(e){
//					nativeAnimation();
					
				    //window.top.location.href=this.href;console.log(this)
				   // e.stopPropagation();
				    //alert("进入");
				    //alert('oh..');
				    //console.log(this.getAttribute("dataindex"))
				    if(this.getAttribute("dataindex")=="2"/*this.href == "../circle/index.html"*/){
//				    	circle = plus.webview.getWebviewById('circle');
//				    	alert(circle==null);
//				    	if(circle)circle.show();
				    	
//				    	mui.openWindow("../cut/index.html");
//						mui.openWindow("../newdetails/html/share_companion.html");
//						window.location.href = "../newdetails/html/share_companion.html"//mui.openWindow有问题，首次进入带ip地址了
						//mui.openWindow("../hello-mui/examples/tabbar.html")
				    	//mui.openWindow("http://120.77.249.40:8084/buyer/changeImg");
				    	//.openWindow("../circle/index.html");
				    }else if( this.getAttribute("dataindex") == "infoA" ){
				    	//console.log(currentInfo);
				    	  //mui.openWindow("../detail/detail.html")
				    	  localStorage.setItem("currentInfo",JSON.stringify(currentInfo));
				    	  window.location.href = "../newdetails/html/tourist.html";
				    	  //mui.openWindow("../newdetails/html/tourist.html");
				    }else if(this.getAttribute("dataindex") == "false"){
				    	
				    }else if(this.getAttribute("dataindex") == "activity"){
				    	drawActivitySingle();//绘制选中的单条线路
				    }else{
				    	var webview = mui.openWindow(this.href);
				    	webview.addEventListener('loaded', function(e){
							//alert('Webview Hided');
						}, false);
						webview.addEventListener('close', function(e){
							
							//alert('Webview closed!');
							if(	localStorage.getItem('city_nme')!='over'){
			        		if(localStorage.getItem('city_nme')!='lat'){
					        			map.centerAndZoomByName(localStorage.getItem('city_nme'));
					        			queryCityPosNow();
					        			
					        		}else{
					        			map.centerAndZoomByName(new BMap.Point(parseFloat(localStorage.getItem('city_lng')),parseFloat(localStorage.getItem('city_lat'))));
					        			queryCityPosNow();
					        		}
					        		
					        		localStorage.setItem('city_nme','over');
					        }
							webview=null;
						}, false );
				    }
				    	
//				    if(this.name == "scan"){
//				    	//alert('打开摄像头');
//				    	captureImage();
//				    }
				});
					map = new Bookingmap();
	        		map.initBaiduMap('allmap');
	        		
	        		//浏览器定位
//					map.addEventListenBrowserLocation(function(r,obj){
//						console.log(obj);
//					});
	        		var cityId;
	        		
	        		//获取下拉框点击后的地名
	        		map.addEventListenDownList(function(value,obj){
	        			console.log(value,obj);
	        			currentCity = obj;
	        			if(currentCity && currentCity.length>2 && currentCity.indexOf('市')!=-1){
							currentCity = currentCity.replace('市','');
						}
	        			currentCityContent.innerHTML = '<input readonly value="'+(currentCity||'深圳')+'" /><span class="mui-icon mui-icon-arrowdown" id="arrowdown"></span>';
	        			queryCityId(obj);
	        			
	        		});
	        		//setTimeout(function(){queryCityId('深圳市');},300);
	        		var currentCityContent = document.getElementById("currentCityContent");
				
					
					
				if(currentCity && currentCity.length>2 && currentCity.indexOf('市')!=-1){
										currentCity = currentCity.replace('市','');
									}
				if(!isPageShow){
					currentCityContent.innerHTML = '<input readonly value="'+(currentCity||'深圳')+'" /><span class="mui-icon mui-icon-arrowdown" id="arrowdown"></span>';
	        		queryCityId((currentCity||'深圳'));
				}
				
	        		function queryCityId(obj){
	        			var cityIndex  = obj.indexOf('市');
	        			if(layerIndex==-1)
	        			layerIndex = layer.open({
						    type: 2
						    ,content: '搜索中'
						  });
	        			mui.ajax(JS_PATH+'/list/getIdbyCityName?cityName='+((cityIndex==-1)?obj:obj.substring(0,cityIndex)),{
							data:{
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'get',//HTTP请求类型
							success:function(data){
								//获得服务器响应
								console.log(data);
								layer.close(layerIndex);
								if(data&& data.length>0){
									//获取城市id
									cityId = data[0].id;
									//queryScenicSpotbyCity(data[0].id);
									// 获取经纬度范围参数
								    var bs = map.map.getBounds();   //获取可视区域
								    var bssw = bs.getSouthWest();   //可视区域左下角
								    var bsne = bs.getNorthEast();   //可视区域右上角
								     
								    var topLat = bsne.lat;
								    var bottomLat = bssw.lat;
								    var leftLng = bssw.lng;
								    var rightLng = bsne.lng;
								    //console.log(bssw,bsne);
									queryScenicSpotbyPOS(map.map.getCenter(),map.map.getZoom(),topLat,bottomLat,leftLng,rightLng)
								}
							},error:function(e,t,errorThrown){
								//alert(t)
								layer.close(layerIndex);
								queryCityId('深圳市');
								//console.log(e,t,errorThrown);
							}
						});
						/*$.ajax({
							type:"get",
							dataType:"jsonp",
							url:'http://120.25.221.94:8080/list/getIdbyCityName?cityName='+((cityIndex==-1)?obj:obj.substring(0,cityIndex)),
							async:true,
							success:function(data){
								//获得服务器响应
								console.log(data);
								layer.close(layerIndex);
								if(data&& data.length>0){
									//获取城市id
									cityId = data[0].id;
									queryScenicSpotbyCity(data[0].id);
									
								}
							}
							,
							error:function(e){
								//alert(t)
								layer.close(layerIndex);
								//queryCityId('深圳市');
								console.log(e);
								//console.log(e,t,errorThrown);
							}
						});*/
//					mui.getJSONP('http://120.25.221.94:8080/list/getIdbyCityName?cityName='+((cityIndex==-1)?obj:obj.substring(0,cityIndex)), {}, function(data) {
//					    console.log(data);
//					});
			     }
	        		
	        		
	        		//获取地点经纬度
	        		map.addEventListenPoint(function(obj){
	        			console.log(obj);
	        			queryScenicSpotbyPOS(obj,10)
	        		});
	        		
	        		//获取起点和终点的位置信息计算驾车时间与距离
	        		map.addEventListenGetRoute(function(value,distance){
	        			
	        		});
	        		
	        		var currentE = null;
	        		map.clickhandler(function(e){
	        			info.style.display = "none";
	        			info.style.bottom = '-50px';
	        			if(e && e.clientY && e.clientY){
	        				
	        				currentE = e;
	        			}
	        			
	        			
	        			
	        		})
	        		
	        		spot.addEventListener('tap',function(){
	        			//spot.style.opacity = 0;
	        			info.style.display = "none";
		        				info.style.bottom = '-50px';
								lufy.style.zIndex = -1;
	        			if(sprite){
								info.style.display = "none";
		        				info.style.bottom = '-50px';
								lufy.style.zIndex = -1;
								TweenLite.to(sprite,0.2,{scaleX:0,scaleY:0,opacity:0});
								
							}
	        		})
	        		map.clickMark(function(o,e){
	        			if(e && e.clientY && e.clientY){
//	        				spot.style.opacity = 0;
//	        				spot.style.width = 10+'px';
//	        				spot.style.height = 10+'px';
//	        				TweenLite.to(spot.style,0.5,{width:50+'px',height:50+'px',opacity:1,top:e.clientY+'px',left:e.clientX+'px'});
							if(sprite){
								sprite.opacity = 0;
//								sprite.scaleX = 0.2;
//								sprite.scaleY = 0.2;
//								lengend.style.pointerEvents = "auto";
//								lufy.style.pointerEvents = "auto";
							lufy.style.zIndex = 99999;
//	        					TweenLite.to(sprite,0.5,{width:50,height:50,opacity:1,y:e.clientY/window.innerHeight*1334,x:e.clientX/window.innerWidth*750});
								var timeIndex = setTimeout(function(){
									clearTimeout(timeIndex);
									var ty = sprite.y;
									sprite.y -= 20;
									TweenLite.to(sprite,0.2,{y:ty,scaleX:1,scaleY:1,opacity:1,onComplete:function(){
										TweenLite.to(sprite,0.1,{y:ty+10,scaleX:0.7,scaleY:0.7,opacity:1,onComplete:function(){
											TweenLite.to(sprite,0.1,{y:ty,scaleX:1,scaleY:1,opacity:1})
										}})
									}})
									
									
									;
								},300);
								
							}
	        			}else if(currentE){
//	        				spot.style.opacity = 0;
//	        				spot.style.width = 10+'px';
//	        				spot.style.height = 10+'px';
//	        				TweenLite.to(spot.style,0.5,{width:50+'px',height:50+'px',opacity:1,top:currentE.clientY+'px',left:currentE.clientX+'px'});
							if(sprite){
								sprite.opacity = 0;
//								sprite.scaleX = 0.2;
//								sprite.scaleY = 0.2;
//	        					TweenLite.to(sprite,0.5,{width:50,height:50,opacity:1,y:currentE.clientY/window.innerHeight*1334,x:currentE.clientX/window.innerWidth*750});
//								lengend.style.pointerEvents = "auto";
//								lufy.style.pointerEvents = "auto";
								lufy.style.zIndex = 99999;
								var timeIndex = setTimeout(function(){
									clearTimeout(timeIndex);
									var ty = sprite.y;
									sprite.y -= 20;
									TweenLite.to(sprite,0.2,{y:ty,scaleX:1,scaleY:1,opacity:1,onComplete:function(){
										TweenLite.to(sprite,0.1,{y:ty+10,scaleX:0.7,scaleY:0.7,opacity:1,onComplete:function(){
											TweenLite.to(sprite,0.1,{y:ty,scaleX:1,scaleY:1,opacity:1})
										}})
									}})
								},300);
							}
	        			}
	        			
	        			console.log(o);
	        			currentInfo = o;
	        			infoContent.innerHTML = o.title+"<p class='mui-ellipsis-2'>"+o.summary+"</p>";
	        			info.style.display = "block";
	        			imgInfo.src = JSON.parse(o.imgbox)[0];
	        			
	        			if(currentInfo.isground&&currentInfo.isground.data[0] == '0'){//已经明确无vr图
	        				vrBtn.disabled = true;
	        			}else{
	        				vrBtn.disabled = false;
	        			}
	        			
	        			
	        			//info.style.bottom = '50px';
	        			TweenLite.to(info.style,0.5,{bottom:'50px'});
//	        			var i = -50;
//	        			var time = setInterval(function(){
//	        				i+=2;
//	        				if(i>50){
//	        					clearInterval(time);
//	        				}
//	        				info.style.bottom = i+'px';
//	        			},1);
	        			
	        			
	        			
	        		});
	        		
	        		//c地图当前中心点，v地图当前层级
	        		map.drageHandler(function(c,v){
	        			console.log(c,v);
	        			// 获取经纬度范围参数
					    var bs = map.map.getBounds();   //获取可视区域
					    var bssw = bs.getSouthWest();   //可视区域左下角
					    var bsne = bs.getNorthEast();   //可视区域右上角
					     
					    var topLat = bsne.lat;
					    var bottomLat = bssw.lat;
					    var leftLng = bssw.lng;
					    var rightLng = bsne.lng;
					    //console.log(bssw,bsne);
					    
					    if(map.map.getZoom()>8)
	        			queryScenicSpotbyPOS(c,v,topLat,bottomLat,leftLng,rightLng)
	        			else{
	        				map.map.clearOverlays();
	        				map.zoomIcon()
	        			}
	        				
	        		});
	        		
	        		map.zoomHandler(function(c,v,_callBack){
	        			console.log(c,v);
	        			// 获取经纬度范围参数
					    var bs = map.map.getBounds();   //获取可视区域
					    var bssw = bs.getSouthWest();   //可视区域左下角
					    var bsne = bs.getNorthEast();   //可视区域右上角
					     
					    var topLat = bsne.lat;
					    var bottomLat = bssw.lat;
					    var leftLng = bssw.lng;
					    var rightLng = bsne.lng;
					    //console.log(bssw,bsne);
					   
					    if(map.map.getZoom()>8)
	        			queryScenicSpotbyPOS(c,v,topLat,bottomLat,leftLng,rightLng,_callBack)
	        			else{
	        				 map.map.clearOverlays();
	        				 map.zoomIcon()
	        			}
	        			
	        		});
	        		//map.trajectory();	显示赛程的
	        	//map.getRoute(null,null,{lng: 114.036184, lat: 22.6139},{lng: 113.906253, lat: 22.485729});
	        	
	        	/*通过城市id获取景点*/
	        	function queryScenicSpotbyCity(id){
	        		mui.ajax(JS_PATH+'/list/scenicSpotbyCity?id='+id,{
							data:{
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'get',//HTTP请求类型
							success:function(data){
								//获得服务器响应
								console.log(data);
								if(data&& data.length>0){
									map.markList = [];
									map.sizeList = [];
									for(var i=0,m=data.length;i<m;i++){
										var item = data[i];
											map.createMarkFromData(item);
									}
								}
							}
						});
	        	}
	        	//queryScenicSpotbyPOS(new BMap.Point(114.06444, 22.548488),15)
	        	/*通过城市经纬度获取景点,p中心点，zoom地图层级*/
	        	function queryScenicSpotbyPOS(p,zoom,topLat,bottomLat,leftLng,rightLng,_callBack){
	        		if(layerIndex==-1)
	        			layerIndex = layer.open({
						    type: 2
						    ,content: '搜索中'
						  });
	        		mui.ajax(JS_PATH+'/list/scenicSpotbyPOS?lng='+p.lng+'&lat='+p.lat+'&zoom='+zoom+'&topLat='+topLat+'&bottomLat='+bottomLat+'&leftLng='+leftLng+'&rightLng='+rightLng,{
							data:{
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'get',//HTTP请求类型
							success:function(data){
								//获得服务器响应
								
								if(data.length>50){
									data = data.slice(0,50);
								}
								console.log(data);
								localStorage.setItem('scenicSpotbyPOS',JSON.stringify(data))
								if(data&& data.length>0){
									var left_data = [];
									//if(zoom<=14){//当地图等级大于14时过滤图标
										
										for(var i=0,m=data.length;i<m;i++){
											var item = data[i];
											var isF = true;
											for( var z = i+1;z<m-1;z++ ){
												var citem = data[z];
												if(zoom>14&&(Math.abs(parseFloat(citem.longitude)-parseFloat(item.longitude))+Math.abs(parseFloat(citem.latitude)-parseFloat(item.latitude)))<0.02){
													//console.log(parseFloat(citem.longitude),parseFloat(item.longitude),parseFloat(citem.latitude),parseFloat(item.latitude));
													isF = false;
													break;
												}else
												if(zoom<=14&&zoom>12&&(Math.abs(parseFloat(citem.longitude)-parseFloat(item.longitude))+Math.abs(parseFloat(citem.latitude)-parseFloat(item.latitude)))<0.2){
													//console.log(parseFloat(citem.longitude),parseFloat(item.longitude),parseFloat(citem.latitude),parseFloat(item.latitude));
													isF = false;
													break;
												}else if(zoom<=12&&zoom>=11&&(Math.abs(parseFloat(citem.longitude)-parseFloat(item.longitude))+Math.abs(parseFloat(citem.latitude)-parseFloat(item.latitude)))<0.3){
													//console.log(parseFl+oat(citem.longitude),parseFloat(item.longitude),parseFloat(citem.latitude),parseFloat(item.latitude));
													isF = false;
													break;
												}else if(zoom<11&&(Math.abs(parseFloat(citem.longitude)-parseFloat(item.longitude))+Math.abs(parseFloat(citem.latitude)-parseFloat(item.latitude)))<0.8){
													isF = false;
													break;
													
												}
											}
											if(isF)left_data.push(item);
											
										}
										
										
									//}
									
									
									map.markList = [];
									map.sizeList = [];
									map.map.clearOverlays();
									if(left_data.length > 0)
									data = left_data;
									
									
									console.log('过滤后的=',left_data);
									for(var i=0,m=data.length;i<m;i++){
										var item = data[i];
//										if(i==0)item.type_id = 8888;//显示活动图标
											map.createMarkFromData(item);
									}
									
									
									if(typeof _callBack == 'function'){
										_callBack();
									}
									
									
								}
								layer.close(layerIndex);
							},error:function(e,t,errorThrown){
								layer.close(layerIndex);
							}
						});
	        	}
	        	
	        	//http://api.map.baidu.com/panorama/v2?ak=tulhDZioYexd9Zub0DojUU9g&width=512&height=256&location=116.313393,40.04778&fov=180
	        	var vrBtn = document.getElementById("vrBtn");
				//监听点击事件
				vrBtn.addEventListener("tap",function () {
				  console.log("tap event trigger");
				  if(currentInfo){
				  	//window.open('http://api.map.baidu.com/panorama/v2?ak=tulhDZioYexd9Zub0DojUU9g&width=512&height=256&location='+currentInfo.longitude+','+currentInfo.latitude+'&fov=360');
				  	
				  	if(currentInfo.isground&&currentInfo.isground.data[0] == '1'){
				  		mui.openWindow(JS_PATH+'/WebVR_Demo-master/panorama.html?location=1,true');
				  		localStorage.setItem('ground_img',currentInfo.ground_img);
				  	}else
				  		mui.openWindow(JS_PATH+'/WebVR_Demo-master/panorama.html?location='+currentInfo.longitude+','+currentInfo.latitude);
				  	
				  	
				  	
				  }
				});
				
				var videoBtn = document.getElementById("videoBtn");
				videoBtn.addEventListener("tap",function () {
				  console.log("tap event trigger");
//				  alert('无视频')
//					mui.openWindow('https://layaair.ldc.layabox.com/demo/h5/demo.html?2d&DOM&Video&core');
					mui.openWindow('newdetails/html/video.html');
				});
				
//				vrBtn.addEventListener("click",function () {
//				  console.log("tap event trigger");
//				  if(currentInfo){
//				  	
//				  }
//				});
				queryActivityAll();
				//查询限制20条的
				function queryActivityAll(){
					humanAjax(JS_PATH+'/activity/queryRecentActivity',{
							data:{
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'get',//HTTP请求类型
							success:function(data){
								if(data){
									
									spot.style.width = '122px';
//									spot.innerHTML = "活动"+data.length;
									for(var i = 0 , m = data.length ;i<m; i++ ){
										spot.innerHTML+='<img src="../icon/flag/label.ico" data-id="'+ data[i].id  +'">';
										activity_content.innerHTML+='<li class="mui-table-view-cell">'
											+ '<a href="javascript:;" dataindex="activity"><p>活动名称：'
											+data[i].name+'</p><p>内容：'
											+data[i].content+'</p><p>开始时间：'
											+data[i].start_time+'</p><p>结束时间：'
											+data[i].end_time+'</p><p class="mui-ellipsis-2">路线：'
											+data[i].route+'</p>'
											+'</a>'
										+ '</li>';
										
									}
									var imgList = spot.getElementsByTagName('img');
									for( var i = 0, m = imgList.length ; i < m ; i++ ){
										imgList[i].addEventListener('tap',function(){
											console.log(this);
											backmap.style.display = "block";
											activity_menu.style.display = "block";
											resultPanel.style.display = "none";
											resultPanel.style.pointerEvents = "none";
											document.querySelector('.BMap_geolocationContainer').style.display = "none";
											spot.style.top = "28px";
											currentCenter = map.map.getCenter();
											map.isActivity = true;
											map.map.clearOverlays();
											queryRouter(this.getAttribute("data-id"));
											
										})
									}
									var spotTime = setTimeout(function(){
										clearTimeout(spotTime);
										
//										spot.style.height="80px";
										spot.style.borderWidth = "8px 5px 8px 5px;";
//										TweenLite.to(spot.style,0.5,{width:'100px',onComplete:function(){
//											TweenLite.to(spot.style,0.3,{width:'50px',onComplete:function(){
//												//spot.style.display = "none";
//												spot.style.width="10px";
//												spot.style.borderWidth = "8px 5px 8px 5px;";
//												spot.innerHTML = "";
//											}});
//										}});
									TweenLite.to(spot.style,1.5,{backgroundSize:'0px 0px',onComplete:function(){
										spot.style.padding = "0px";
									}});
									},3000);
									
									//给活动赋值
//									spot.addEventListener('tap',function(e){
//										if(spot.innerHTML==""){
//											spot.style.width="122px";
//											spot.style.height="84px";
////											spot.innerHTML = "活动"+data.length;
//											for(var i = 0 , m = data.length ;i<m; i++ ){
//												spot.innerHTML+='<img src="../icon/flag/label.ico" data-id="'+  data[i].id +'">'
//											}
//											spot.style.borderWidth = "4px 5px 4px 5px;";
//										}else{
//											spot.innerHTML = "";
//											spot.style.borderWidth = "8px 5px 8px 5px;";
//											spot.style.width="10px";
//											spot.style.height="10px";
//										}
//										
//									})
									
								}else{
									
								}
								
							},error:function(e){
								mui.toast("系统出错");
							}
						},true,'活动查询中');
				}
				
				
				//根据活动id查询活动路线
				function queryRouter(id){
					humanAjax(JS_PATH+'/activity/queryRouter',{
							data:{
								id:id
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'get',//HTTP请求类型
							success:function(data){
								
								for( var i = 0 , m = data.length ; i < m ; i++ ){
									var item = data[i];
									if(item.obj_ids&&item.obj_ids!=""){
										var ids = item.obj_ids.split(',');
										if(i==0&&ids[0]){
											queryScenicById(ids[0],data);
										}
										
										
										
										
									}
									
									
								}
								
							},error:function(e){
								mui.toast("系统出错");
							}
					},false,'活动查路线中');
				}
				
				//通过景点id获取旅游景点详情
				function queryScenicById(id,d){
					humanAjax(JS_PATH+'/list/queryScenicById',{
							data:{
								id:id
							},
							crossDomain :true,
							dataType:'json',//服务器返回json格式数据
							type:'get',//HTTP请求类型
							success:function(data){
								
								for( var i = 0 , m = data.length ; i < m ; i++ ){//景点必须保证只有一个
									var item = data[i];
									var lng = parseFloat(item.longitude);
									var lat = parseFloat(item.latitude);
									if(!(isNaN(lng)||isNaN(lat)))
									map.panTo({lng:lng,lat:lat});
									markIconToActivity(d);
								}
								
							},error:function(e){
								mui.toast("系统出错");
							}
					},false);
				}
				
				
				
				
				//当地图跳转到有活动地方后显示有活动的图标
				function markIconToActivity(data){
					var _id = [];//保存已经查询过的景点id，避免重复查询
					var _ids = [];
					var idObject= {};
					var num = 0;
					var total = 0;
					for( var i = 0 , m = data.length ; i < m ; i++ ){
						var item = data[i];
						if(item.obj_ids&&item.obj_ids!=""){
							var ids = item.obj_ids.split(',');
							_ids.push(ids);
							total+=ids.length ;console.log('ids=',ids,total);
							for(var j = 0 ; j < ids.length ; j++ ){
								var id = ids[j];
								
								if(id&&id!=""&&_id.indexOf(id)==-1){
									_id.push(id);
									humanAjax(JS_PATH+'/list/queryScenicById',{
											data:{
												id:id
											},
											crossDomain :true,
											dataType:'json',//服务器返回json格式数据
											type:'get',//HTTP请求类型
											success:function(data){
												//设置景点对应图标
												for( var i = 0 , m = data.length ; i < m ; i++ ){//景点必须保证只有一个
													var item = data[i];
													var lng = parseFloat(item.longitude);
													var lat = parseFloat(item.latitude);
													idObject[item.id] = item;
													
													var opts = {
														  position : new BMap.Point( lng , lat ),    // 指定文本标注所在的地理位置
														  offset   : new BMap.Size(10, -30)    //设置文本偏移量
														}
														var label = new BMap.Label(item.title, opts);  // 创建文本标注对象
															label.setStyle({
																 color : "red",
																 fontSize : "12px",
																 height : "20px",
																 lineHeight : "20px",
																 fontFamily:"微软雅黑"
															 });
														map.map.addOverlay(label);   
													
													
//													map.createMarkFromData(item);
//													map.changeIconSize();
												}
												console.log(num++);
												if(num==total){
													console.log('路线');
													
													
													drawRoute(_ids,idObject);
													
												}
											},error:function(e){
												mui.toast("系统出错");
											}
									},false);
								}else{
									console.log(num++);
									if(num==total){
										console.log('路线');
										drawRoute(_ids,idObject);
									}
								}
							}
						}
						
					}
				}

			}
			
			var colors = ["blue","red","green","orange","back"];
			function drawRoute(_ids,idObject){
				for(var z = 0; z < _ids.length ; z++ ){
					var ids = _ids[z];
					var points = [];
					for(var i = 0 ; i < ids.length ; i++ ){
						var item = idObject[ids[i]];
						var lng = parseFloat(item.longitude);
						var lat = parseFloat(item.latitude);
						points.push( new BMap.Point( lng , lat ) );
					}
					
					var curve = new BMapLib.CurveLine(points, {strokeColor:colors[z], strokeWeight:3, strokeOpacity:0.5}); //创建弧线对象
					map.map.addOverlay(curve); //添加到地图中
					curve.enableEditing(); //开启编辑功能
					
					
				}
			}
			
			
			
			function drawActivitySingle(){
				
			}
			
			
			
			
			//-------------------------------------------------------------------------------------------------------------
			// H5 plus事件处理
//function plusReady(){
//	// 弹出系统等待对话框
//	var w = plus.nativeUI.showWaiting( "等待中..." );//,{loading:{icon:"../icon/mark/1c7a3e2fd802dc165dd4c3b94691292d.gif"}}
//	// 2秒后更新
//	setTimeout( function(){
//			//w.setTitle( "正在更新" );
//			w.close();
//	}, 2000 );
//}
//if(window.plus){
//	plusReady();
//}else{
//	document.addEventListener("plusready",plusReady,false);
//}
		function nativeAnimation(){
			// 弹出系统等待对话框
			
			var w = plus.nativeUI.showWaiting( "等待中..." );//,{loading:{icon:"../icon/mark/1c7a3e2fd802dc165dd4c3b94691292d.gif"}}
			// 2秒后更新
			setTimeout( function(){
					w.close();
			}, 2000 );
		}
			
			</script>
			<!--<script type="text/javascript" src="../js/lufy/lufylegend-1.10.1.min.js"></script>
			<script type="text/javascript" src="../js/lufy/lib/lufylegend.ui-0.14.1.min.js"></script>
			<script>
				var layerQS;
				var imgData = [
					{name:"ok_button",path:"../images/schedule/hm_button.png"},
					{name:"hd_button",path:"../images/schedule/hd_button.png"}
				];
				LInit(1000/60, "legend", 750,1334, main);
				function main () {
					LLoadManage.load(imgData,null,gameInit);
					
				}
				function gameInit(result){
					layerQS = new LSprite();
					addChild(layerQS);
					
					sprite = new LSprite();
					sprite.x = 750/2-60;
					sprite.y = 1334/2-90;
					addChild(sprite);
					
					update();
					initCanvas(result);
					LGlobal.stage.addEventListener(LEvent.WINDOW_RESIZE,update);
					LGlobal.stage.addEventListener(LMouseEvent.MOUSE_DOWN,mouseHandler);
					
				}
				
				function mouseHandler(e){
					if(e.target != sprite){
						info.style.display = "none";
	        			info.style.bottom = '-50px';
						lengend.style.pointerEvents = "none";
						TweenLite.to(sprite,0.2,{scaleX:0,scaleY:0,opacity:0});
						
					}
					console.log('舞台',(e.target == sprite))
				}
				
				
				function initCanvas(result){
					LMouseEventContainer.set(LMouseEvent.MOUSE_DOWN,true);
					layerQS.graphics.clear();
					layerQS.graphics.drawRect(0.5, "#ffffff", [0, 0, 750, 1334]);
//					sprite.graphics.clear();
//					sprite.graphics.drawRect(1, "#ff0000", [-50, -50, 100, 100], true, "#880088");
//					sprite.graphics.drawEllipse(20, "#E4D6AC", [-50, -50, 150, 200]);
					sprite.scaleX = sprite.scaleY = 0;
					sprite.addEventListener(LMouseEvent.MOUSE_DOWN,function(e){
						console.log(e);
						
						lengend.style.pointerEvents = "none";
						TweenLite.to(sprite,0.5,{scaleX:0,scaleY:0,opacity:0});
					});
					var shape = new LShape();
					shape.graphics.drawEllipse(5, "#DF7979", [-50, -50, 150+20, 200+20]);
					sprite.addChild(shape);
					var bitmapDataUp = new LBitmapData(result["ok_button"],0,0,98,48);
					var bitmapUp = new LBitmap(bitmapDataUp);
					var bitmapDataOver = new LBitmapData(result["ok_button"],0,48,98,48);
					var bitmapOver = new LBitmap(bitmapDataOver);
					//bitmapUp.scaleX = 0.5;
					//bitmapOver.scaleX = 0.5;
					var button02 = new LButton(bitmapUp,bitmapOver);
					button02.x = -13;
					button02.y = -55;
					sprite.addChild(button02);
					button02.addEventListener(LMouseEvent.MOUSE_DOWN,function(e){
						localStorage.setItem("currentInfo",JSON.stringify(currentInfo));
				    	window.location.href = "../newdetails/html/tourist.html";
					});
					
					
					var bitmapDataUp2 = new LBitmapData(result["hd_button"],0,0,98,48);
					var bitmapUp2 = new LBitmap(bitmapDataUp2);
					var bitmapDataOver2 = new LBitmapData(result["hd_button"],0,48,98,48);
					var bitmapOver2 = new LBitmap(bitmapDataOver2);
					var button03 = new LButton(bitmapUp2,bitmapOver2);
					button03.x = -13;
					button03.y = 130;
					sprite.addChild(button03);
					
//					layerQS.graphics.clear();
//					layerQS.graphics.drawRect(1, "#ff0000", [0, 0, 50, 50], true, "#880088");
//					layerQS.graphics.drawRect(1, "#ff0000", [700, 0, 50, 50], true, "#880088");
//					var com = new LComboBox();
//					com.x = 50;
//					com.y = 50;
//					com.setChild({label:"测试一",value:"data1"});
//					com.setChild({label:"测试二",value:"data2"});
//					com.setChild({label:"测试三",value:"data3"});
//					com.setChild({label:"测试四",value:"data4"});
//					com.setChild({label:"测试五",value:"data5"});
//					com.setChild({label:"测试六",value:"data6"});
//					com.setChild({label:"测试七",value:"data7"});
//					com.setChild({label:"测试八",value:"data8"});
//					com.setChild({label:"测试九",value:"data9"});
//					com.setChild({label:"测试十",value:"data10"});
//					com.setChild({label:"测试十一",value:"data11"});
//					com.setChild({label:"测试十二",value:"data12"});
//					com.setChild({label:"测试十三",value:"data13"});
//					addChild(com);
					
				}
			
			
			function update(){
				LGlobal.resize(window.innerWidth,window.innerHeight);
				allmap.style.height = window.innerHeight+"px";
//				layer.graphics.drawRect(1, "#ff0000", [0, LGlobal.height - 50, 50, 50], true, "#880088");
//				layer.graphics.drawRect(1, "#ff0000", [LGlobal.width - 50, LGlobal.height - 50, 50, 50], true, "#880088");
			}
			</script>-->
			<script>
			mui.init({
				swipeBack:true //启用右滑关闭功能
			});
			var menuWrapper = document.getElementById("menu-wrapper");
			var menu = document.getElementById("menu");
			var menuWrapperClassList = menuWrapper.classList;
			var backdrop = document.getElementById("menu-backdrop");
			
			backdrop.addEventListener('tap', toggleMenu);
			document.getElementById("icon-menu").addEventListener('tap',toggleMenu)
			//下沉菜单中的点击事件
			mui('#menu').on('tap', 'a', function() {
				toggleMenu();
				console.log(this.innerHTML);
			});
			var busying = false;

			function toggleMenu() {
				if (busying) {
					return;
				}
				busying = true;
				if (menuWrapperClassList.contains('mui-active')) {
					document.body.classList.remove('menu-open');
					menuWrapper.className = 'menu-wrapper fade-out-up animated';
					menu.className = 'menu bounce-out-up animated';
					setTimeout(function() {
						backdrop.style.opacity = 0;
						menuWrapper.classList.add('hidden');
					}, 500);
				} else {
					document.body.classList.add('menu-open');
					menuWrapper.className = 'menu-wrapper fade-in-down animated mui-active';
					menu.className = 'menu bounce-in-down animated';
					backdrop.style.opacity = 1;
				}
				setTimeout(function() {
					busying = false;
				}, 500);
			}
			
			function hideActivityPanel(){
				if (menuWrapperClassList.contains('mui-active')) {
					document.body.classList.remove('menu-open');
					menuWrapper.className = 'menu-wrapper fade-out-up animated';
					menu.className = 'menu bounce-out-up animated';
					setTimeout(function() {
						backdrop.style.opacity = 0;
						menuWrapper.classList.add('hidden');
					}, 500);
				}
			}
			
		</script>
	</body>
</html>
